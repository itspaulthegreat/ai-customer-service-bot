export const getApprovedReviews = webMethod(Permissions.Anyone, async (productId, filter = "newest", limit = CONSTANTS.REVIEWS.PAGE_SIZE, skip = 0) => {
    try {
        let query = wixData.query(CONSTANTS.COLLECTIONS.REVIEWS)
            .eq("productId", productId)
            .eq("status", CONSTANTS.REVIEWS.STATUSES.APPROVED)
            .limit(limit)
            .skip(skip);

        switch (filter) {
        case "highestRating":
            query = query.descending("rating").descending("_createdDate");
            break;
        case "lowestRating":
            query = query.ascending("rating").descending("_createdDate");
            break;
        case "newest":
            query = query.descending("_createdDate");
            break;
        case "oldest":
            query = query.ascending("_createdDate");
            break;
        default:
            query = query.descending("_createdDate");
        }

        const result = await query.find();
        return {
            reviews: result.items,
            hasNext: result.hasNext(),
            totalCount: result.totalCount
        };
    } catch (error) {
        console.error("Error fetching approved reviews:", error);
        return { reviews: [], hasNext: false, totalCount: 0 };
    }
});